<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>macOS Sequoia Web Experience</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

<style>
Â  Â  :root {
Â  Â  Â  Â  --bg-peal: rgba(255, 255, 255, 0.1); /* non-blurred fallback */
Â  Â  Â  Â  --dock-bg: rgba(20, 20, 20, 0.3);
Â  Â  Â  Â  --menu-bg: rgba(20, 20, 20, 0.3);
Â  Â  Â  Â  --window-bg: rgba(30, 30, 32, 0.85);
Â  Â  Â  Â  --window-header: #2d2d2d;
Â  Â  Â  Â  --text-color: #ffffff;
Â  Â  Â  Â  --accent: #007aff;
Â  Â  Â  Â  --system-font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
Â  Â  }

Â  Â  * { box-sizing: border-box; user-select: none; }
Â  Â  body, html {
Â  Â  Â  Â  margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden;
Â  Â  Â  Â  font-family: var(--system-font); color: var(--text-color);
Â  Â  Â  Â  /* NEW: Sequoia-inspired Wallpaper */
Â  Â  Â  Â  background: linear-gradient(160deg, #1a4a2a, #2a5f3a, #f2a94a, #f5c07b, #5b8abf, #2a4b7a);
Â  Â  Â  Â  background-size: 600% 600%;
Â  Â  Â  Â  animation: gradientBG 20s ease infinite;
Â  Â  Â  Â  cursor: default;
Â  Â  }

Â  Â  @keyframes gradientBG {
Â  Â  Â  Â  0% { background-position: 0% 50%; }
Â  Â  Â  Â  50% { background-position: 100% 50%; }
Â  Â  Â  Â  100% { background-position: 0% 50%; }
Â  Â  }

Â  Â  /* --- Boot Screen --- */
Â  Â  #boot-screen {
Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  background: #000; z-index: 99999;
Â  Â  Â  Â  display: flex; flex-direction: column; justify-content: center; align-items: center;
Â  Â  Â  Â  transition: opacity 1s ease-out;
Â  Â  }
Â  Â  .apple-logo { color: white; font-size: 80px; margin-bottom: 40px; }
Â  Â  .loading-bar {
Â  Â  Â  Â  width: 200px; height: 6px; background: #333; border-radius: 3px; overflow: hidden;
Â  Â  }
Â  Â  .loading-progress {
Â  Â  Â  Â  height: 100%; background: #fff; width: 0%; border-radius: 3px;
Â  Â  Â  Â  transition: width 3s ease-in-out;
Â  Â  }

Â  Â  /* --- UI Layout --- */
Â  Â  #desktop { width: 100%; height: 100%; position: relative; }
Â  Â Â 
Â  Â  /* Menu Bar */
Â  Â  #menubar {
Â  Â  Â  Â  position: absolute; top: 0; width: 100%; height: 30px;
Â  Â  Â  Â  background: var(--menu-bg); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
Â  Â  Â  Â  display: flex; justify-content: space-between; align-items: center;
Â  Â  Â  Â  padding: 0 20px; font-size: 13px; font-weight: 500; z-index: 5000;
Â  Â  Â  Â  border-bottom: 1px solid rgba(255,255,255,0.1);
Â  Â  }
Â  Â  .menu-left, .menu-right { display: flex; gap: 15px; align-items: center; }
Â  Â  .menu-item:hover { background: rgba(255,255,255,0.1); border-radius: 4px; padding: 2px 8px; margin: -2px -8px;}
Â  Â  .apple-icon { font-size: 16px; }
Â  Â  #active-app-name { font-weight: 700; }

Â  Â  /* Dock */
Â  Â  #dock-container {
Â  Â  Â  Â  position: absolute; bottom: 10px; width: 100%;
Â  Â  Â  Â  display: flex; justify-content: center; z-index: 6000;
Â  Â  }
Â  Â  #dock {
Â  Â  Â  Â  background: var(--dock-bg);
Â  Â  Â  Â  backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  Â  height: 70px; padding: 5px 10px; border-radius: 20px;
Â  Â  Â  Â  display: flex; align-items: flex-end; gap: 8px;
Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(0,0,0,0.3);
Â  Â  Â  Â  transition: all 0.2s ease;
Â  Â  }
Â  Â  .dock-item {
Â  Â  Â  Â  width: 55px; height: 55px; border-radius: 15px; /* IMPROVED: Squircle shape */
Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center; justify-content: center;
Â  Â  Â  Â  transition: all 0.2s cubic-bezier(0.25, 1, 0.5, 1); position: relative;
Â  Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .dock-icon-svg { width: 100%; height: 100%; border-radius: 15px; }
Â  Â Â 
Â  Â  /* IMPROVED: More subtle dock hover effect */
Â  Â  .dock-item:hover { transform: scale(1.15) translateY(-8px); margin: 0 3px; }
Â  Â  .dock-dot {
Â  Â  Â  Â  width: 5px; height: 5px; background: rgba(255,255,255,0.4); border-radius: 50%;
Â  Â  Â  Â  position: absolute; bottom: -8px; display: none;
Â  Â  }
Â  Â  .dock-item.active .dock-dot { display: block; }
Â  Â Â 
Â  Â  @keyframes bounce {
Â  Â  Â  Â  0%, 100% { transform: translateY(0); }
Â  Â  Â  Â  50% { transform: translateY(-20px); }
Â  Â  }
Â  Â  .bouncing { animation: bounce 0.6s ease infinite; }

Â  Â  /* --- Windows System --- */
Â  Â  .window {
Â  Â  Â  Â  position: absolute; background: var(--window-bg);
Â  Â  Â  Â  backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.15);
Â  Â  Â  Â  box-shadow: 0 15px 40px rgba(0,0,0,0.4);
Â  Â  Â  Â  display: flex; flex-direction: column; overflow: hidden;
Â  Â  Â  Â  min-width: 300px; min-height: 200px;
Â  Â  Â  Â  transition: transform 0.15s, opacity 0.15s, box-shadow 0.2s, top 0.2s ease-out, left 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out;
Â  Â  Â  Â  transform-origin: center;
Â  Â  }
Â  Â Â 
Â  Â  .window.opening { animation: winOpen 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
Â  Â  @keyframes winOpen { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; }}

Â  Â  /* IMPROVED: More visible inactive state */
Â  Â  .window.inactive {
Â  Â  Â  Â  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
Â  Â  Â  Â  border-color: rgba(255,255,255,0.05);
Â  Â  Â  Â  background: rgba(45, 45, 47, 0.7); /* Darker inactive */
Â  Â  }
Â  Â  .window.inactive .traffic-lights span { background-color: #555 !important; color: #555 !important;}
Â  Â  .window.inactive .window-content { opacity: 0.7; }

Â  Â  .window-header {
Â  Â  Â  Â  height: 30px; background: rgba(255,255,255,0.05);
Â  Â  Â  Â  display: flex; align-items: center; position: relative; cursor: grab;
Â  Â  }
Â  Â  .window-header:active { cursor: grabbing; }
Â  Â Â 
Â  Â  .traffic-lights {
Â  Â  Â  Â  display: flex; gap: 8px; margin-left: 12px; z-index: 2;
Â  Â  }
Â  Â  .t-btn {
Â  Â  Â  Â  width: 12px; height: 12px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
Â  Â  Â  Â  font-size: 8px; color: transparent; transition: 0.1s; cursor: default;
Â  Â  }
Â  Â  .traffic-lights:hover .t-btn { color: rgba(0,0,0,0.6); }
Â  Â  .close-btn { background: #ff5f56; }
Â  Â  .min-btn { background: #ffbd2e; }
Â  Â  .max-btn { background: #27c93f; }

Â  Â  .window-title {
Â  Â  Â  Â  position: absolute; width: 100%; text-align: center; font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.8); pointer-events: none;
Â  Â  }
Â  Â  .window-content {
Â  Â  Â  Â  flex: 1; overflow: auto; position: relative;
Â  Â  Â  Â  user-select: text; /* Allow text selection inside apps */
Â  Â  }

Â  Â  /* --- NEW: Merged Toolbar Style (Sequoia) --- */
Â  Â  .window.merged-toolbar .window-header {
Â  Â  Â  Â  background: transparent; /* Header itself is transparent */
Â  Â  Â  Â  height: 45px; /* Taller to accommodate buttons */
Â  Â  Â  Â  position: absolute; /* Float over content */
Â  Â  Â  Â  top: 0; left: 0; width: 100%;
Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  border: none;
Â  Â  }
Â  Â  .window.merged-toolbar .traffic-lights {
Â  Â  Â  Â  margin-top: 14px; /* Move them down */
Â  Â  Â  Â  margin-left: 14px;
Â  Â  }
Â  Â  .window.merged-toolbar .window-title {
Â  Â  Â  Â  line-height: 45px; /* Center in new taller header */
Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  color: rgba(255,255,255,0.7);
Â  Â  }
Â  Â  .window.merged-toolbar .window-content {
Â  Â  Â  Â  padding-top: 45px; /* Push content below floating header */
Â  Â  }
Â  Â  /* --- End Merged Toolbar Style --- */

Â  Â  /* jQuery UI Resizable Handle Fix */
Â  Â  .ui-resizable-se { bottom: 0; right: 0; width: 15px; height: 15px; background: none; }

Â  Â  /* --- NEW: Tiling Ghost --- */
Â  Â  #tiling-ghost {
Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  background: rgba(0, 122, 255, 0.3);
Â  Â  Â  Â  border: 2px dashed var(--accent);
Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  z-index: 9999;
Â  Â  Â  Â  display: none;
Â  Â  Â  Â  transition: all 0.1s ease;
Â  Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  }

Â  Â  /* --- Context Menu --- */
Â  Â  #context-menu {
Â  Â  Â  Â  position: absolute; background: rgba(40,40,40,0.9); backdrop-filter: blur(20px);
Â  Â  Â  Â  border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 5px 0;
Â  Â  Â  Â  width: 180px; display: none; z-index: 99999;
Â  Â  Â  Â  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
Â  Â  }
Â  Â  .ctx-item { padding: 6px 15px; font-size: 13px; cursor: default; display: flex; justify-content: space-between;}
Â  Â  .ctx-item:hover { background: var(--accent); color: white; }
Â  Â  .ctx-hr { border-top: 1px solid rgba(255,255,255,0.1); margin: 4px 0; }

Â  Â  /* --- APP SPECIFIC STYLES --- */

Â  Â  /* Finder */
Â  Â  .finder-layout { display: flex; height: 100%; background: #1e1e1e; color: #ddd; }
Â  Â  .finder-sidebar { width: 140px; background: rgba(50,50,50,0.3); padding: 10px; backdrop-filter: blur(10px); display: flex; flex-direction: column; gap: 5px;}
Â  Â  .sidebar-item { padding: 5px 10px; border-radius: 5px; font-size: 12px; display: flex; align-items: center; gap: 8px; cursor: pointer;}
Â  Â  .sidebar-item:hover { background: rgba(255,255,255,0.1); }
Â  Â  .sidebar-item i { color: var(--accent); width: 15px; text-align: center;}
Â  Â  .finder-main { flex: 1; padding: 10px; overflow-y: auto; }
Â  Â  .finder-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 15px; }
Â  Â  .file-item { display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; }
Â  Â  .file-icon { font-size: 40px; color: #5dade2; margin-bottom: 5px; }
Â  Â  .file-icon.folder { color: #5dade2; }
Â  Â  .file-icon.text { color: #ddd; }
Â  Â  .file-icon.img { color: #58d68d; }
Â  Â  .file-name { font-size: 12px; word-break: break-all; padding: 2px 4px; border-radius: 3px;}
Â  Â  .file-item:hover .file-name { background: var(--accent); }
Â  Â Â 
Â  Â  /* NEW: Finder Merged Toolbar */
Â  Â  #win-finder .window-title { display: none; }
Â  Â  .window.merged-toolbar .finder-layout { background: #2e2e2e; }
Â  Â  .window.merged-toolbar .finder-sidebar {
Â  Â  Â  Â  padding-top: 50px; /* Push content down below traffic lights */
Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  top: 0; left: 0; bottom: 0;
Â  Â  Â  Â  background: rgba(30,30,30,0.7); /* Thicker material */
Â  Â  Â  Â  backdrop-filter: blur(15px);
Â  Â  }
Â  Â  .window.merged-toolbar .finder-main {
Â  Â  Â  Â  margin-left: 140px; /* Account for sidebar */
Â  Â  Â  Â  padding-top: 10px; /* Reset padding */
Â  Â  }

Â  Â  /* Terminal */
Â  Â  .terminal-app { background: #101010; color: #33ff00; font-family: 'Courier New', monospace; padding: 10px; height: 100%; overflow-y: auto; font-size: 13px;}
Â  Â  .term-line { margin-bottom: 2px; line-height: 1.4; }
Â  Â  .term-input-line { display: flex; }
Â  Â  .term-prompt { color: #00bfff; margin-right: 8px; }
Â  Â  #term-input { background: transparent; border: none; color: #33ff00; font-family: inherit; font-size: inherit; flex: 1; outline: none; }
Â  Â Â 
Â  Â  /* TextEdit */
Â  Â  .textedit-app { background: #2d2d2d; height: 100%; display: flex; flex-direction: column; }
Â  Â  .text-toolbar { padding: 5px; background: #3a3a3a; border-bottom: 1px solid #444; display: flex; gap: 5px; }
Â  Â  .text-tool { padding: 4px 8px; background: #444; border-radius: 4px; cursor: pointer; font-size: 12px;}
Â  Â  #text-area { flex: 1; background: #1e1e1e; color: #eee; border: none; padding: 15px; font-family: var(--system-font); font-size: 14px; outline: none; resize: none; line-height: 1.5; }
Â  Â  /* NEW: TextEdit Merged Toolbar */
Â  Â  .window.merged-toolbar .text-toolbar {
Â  Â  Â  Â  background: rgba(30,30,30,0.7);
Â  Â  Â  Â  backdrop-filter: blur(15px);
Â  Â  Â  Â  border-bottom: 1px solid rgba(255,255,255,0.1);
Â  Â  Â  Â  padding-left: 10px;
Â  Â  }
Â  Â  .window.merged-toolbar .textedit-app { background: #1e1e1e; }
Â  Â  .window.merged-toolbar .window-content { padding-top: 0; } /* Content handles its own padding */
Â  Â  .window.merged-toolbar .textedit-app {
Â  Â  Â  Â  padding-top: 45px;
Â  Â  }

Â  Â  /* Sketch (Paint) */
Â  Â  .paint-app { display: flex; flex-direction: column; height: 100%; background: #fff; }
Â  Â  .paint-toolbar { padding: 8px; background: #f0f0f0; border-bottom: 1px solid #ccc; display: flex; gap: 10px; align-items: center; color: #333;}
Â  Â  #paint-canvas { background: white; cursor: crosshair; touch-action: none; flex: 1; display: block;}
Â  Â Â 
Â  Â  /* Calculator */
Â  Â  .calc-app { background: #1c1c1c; height: 100%; display: flex; flex-direction: column; padding: 10px; }
Â  Â  #calc-display { background: transparent; color: white; font-size: 36px; text-align: right; border: none; width: 100%; margin-bottom: 10px; outline: none; font-weight: 300;}
Â  Â  .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; flex: 1; }
Â  Â  .calc-btn { border: none; border-radius: 50%; font-size: 18px; cursor: pointer; transition: filter 0.1s; color: white;}
Â  Â  .calc-btn:active { filter: brightness(1.2); }
Â  Â  .c-num { background: #555; }
Â  Â  .c-op { background: #ff9f0a; font-size: 22px; padding-top: 3px;}
Â  Â  .c-top { background: #a5a5a5; color: black; }
Â  Â  .c-zero { grid-column: span 2; border-radius: 30px; text-align: left; padding-left: 25px;}

Â  Â  /* Safari */
Â  Â  .safari-app { display: flex; flex-direction: column; height: 100%; background: #fff; }
Â  Â  .safari-bar { padding: 8px; background: #f0f0f0; border-bottom: 1px solid #ccc; display: flex; gap: 10px; align-items: center; }
Â  Â  .url-bar { flex: 1; background: #ddd; border: none; padding: 5px 10px; border-radius: 8px; text-align: center; font-size: 12px; color: #333; outline: none;}
Â  Â  .safari-frame { flex: 1; border: none; width: 100%; background: white; }
Â  Â  /* NEW: Safari Merged Toolbar */
Â  Â  #win-safari .window-title { display: none; }
Â  Â  .window.merged-toolbar .safari-app { background: #2e2e2e; }
Â  Â  .window.merged-toolbar .safari-bar {
Â  Â  Â  Â  padding-left: 80px; /* Make space for traffic lights */
Â  Â  Â  Â  padding-top: 10px;
Â  Â  Â  Â  padding-bottom: 10px;
Â  Â  Â  Â  background: rgba(30,30,30,0.7);
Â  Â  Â  Â  backdrop-filter: blur(15px);
Â  Â  Â  Â  border-bottom: 1px solid rgba(255,255,255,0.1);
Â  Â  }
Â  Â  .window.merged-toolbar .url-bar { background: #555; color: #eee; }
Â  Â  .window.merged-toolbar .safari-bar i { color: #bbb; }
Â  Â  .window.merged-toolbar .window-content { padding-top: 0; } /* Content handles its own padding */
Â  Â  .window.merged-toolbar .safari-app {
Â  Â  Â  Â  padding-top: 45px;
Â  Â  }

Â  Â  /* Studio (Video) */
Â  Â  .studio-app { background: #000; height: 100%; display: flex; flex-direction: column; }
Â  Â  .video-stage { flex: 1; display: flex; justify-content: center; align-items: center; overflow: hidden; position: relative;}
Â  Â  #main-video { max-width: 100%; max-height: 100%; }
Â  Â  .studio-controls { height: 80px; background: #1a1a1a; padding: 10px; display: flex; flex-direction: column; gap: 5px; }
Â  Â  .filters-row { display: flex; gap: 10px; justify-content: center; }
Â  Â  .filter-btn { padding: 4px 10px; background: #333; border-radius: 4px; font-size: 11px; cursor: pointer; border: 1px solid #444;}
Â  Â  .filter-btn.active { background: var(--accent); border-color: var(--accent); }
Â  Â  .playback-row { display: flex; justify-content: center; align-items: center; gap: 15px; color: #ddd;}
Â  Â Â 
Â  Â  /* Settings */
Â  Â  .settings-app { padding: 20px; color: white; display: flex; flex-direction: column; gap: 20px; align-items: center;}
Â  Â  .wall-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
Â  Â  .wall-thumb { height: 80px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: 0.2s; background-size: cover; background-position: center; display:flex; justify-content:center; align-items:center; font-size:11px; font-weight:600; text-shadow: 0 1px 2px #000;}
Â  Â  .wall-thumb:hover { transform: scale(1.02); }
Â  Â  .wall-thumb.selected { border-color: var(--accent); }
Â  Â  /* NEW: Settings Merged Toolbar */
Â  Â  .window.merged-toolbar .settings-app {
Â  Â  Â  Â  background: #2e2e2e;
Â  Â  }

Â  Â  /* --- NEW: Widgets App --- */
Â  Â  .widgets-app { padding: 20px; display: flex; flex-direction: column; gap: 15px; }
Â  Â  .widget { background: rgba(30,30,30,0.6); backdrop-filter: blur(15px); border-radius: 15px; padding: 15px; }
Â  Â  .widget-clock { text-align: center; }
Â  Â  .widget-clock .time { font-size: 40px; font-weight: 600; }
Â  Â  .widget-clock .date { font-size: 14px; color: #aaa; }
Â  Â  .widget-weather { display: flex; align-items: center; justify-content: space-around; }
Â  Â  .widget-weather .temp { font-size: 30px; font-weight: 500; }
Â  Â  .widget-weather .icon { font-size: 30px; color: #ffcc00; }
Â  Â  .widget-weather .loc { font-size: 14px; color: #aaa; }
Â  Â  #win-widgets .window-header { background: transparent !important; }
Â  Â  #win-widgets .window-content { background: #2e2e2e; }


Â  Â  /* SVGs for Icons (Data URIs for single file) */
Â  Â  .icon-finder { background: linear-gradient(180deg, #e3e3e3 0%, #c7c7c7 100%); position: relative; overflow: hidden; }
Â  Â  .icon-finder::after { content: ':)'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(90deg); font-size: 30px; font-weight: bold; color: #2a62b3; font-family: monospace;}
Â  Â Â 
Â  Â  .icon-safari { background: white; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23fff'/%3E%3Ccircle cx='50' cy='50' r='45' fill='%231facfd'/%3E%3Cpath d='M50 5 L50 95 M5 50 L95 50' stroke='rgba(255,255,255,0.3)' stroke-width='1'/%3E%3Cpolygon points='50,10 60,45 90,50 55,60 50,90 40,55 10,50 45,40' fill='white'/%3E%3Cpolygon points='50,10 55,45 50,50 45,45' fill='%23ea4335'/%3E%3C/svg%3E"); background-size: cover;}
Â  Â Â 
Â  Â  .icon-terminal { background: #222; position: relative; }
Â  Â  .icon-terminal::after { content: '>_'; color: #fff; position: absolute; top: 10px; left: 10px; font-family: monospace; font-size: 24px; font-weight: bold;}
Â  Â Â 
Â  Â  .icon-text { background: linear-gradient(180deg, #fdfdfd 0%, #dcdcdc 100%); position: relative; }
Â  Â  .icon-text::after { content: ''; position: absolute; top: 15px; left: 10px; right: 10px; height: 2px; background: #999; box-shadow: 0 5px 0 #999, 0 10px 0 #999, 0 15px 0 #999; }
Â  Â Â 
Â  Â  .icon-paint { background: linear-gradient(45deg, #ff3b30, #ff9500, #ffcc00, #4cd964, #5ac8fa, #007aff, #5856d6, #ff2d55); }
Â  Â  .icon-paint::after { content: '\f1fc'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 30px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-shadow: 0 2px 5px rgba(0,0,0,0.3);}

Â  Â  .icon-calc { background: #333; display: grid; grid-template-columns: 1fr 1fr; padding: 5px; gap: 2px;}
Â  Â  .icon-calc div { background: #ff9f0a; border-radius: 4px; }
Â  Â  .icon-calc div:nth-child(1), .icon-calc div:nth-child(2) { background: #555; }

Â  Â  .icon-studio { background: linear-gradient(135deg, #3a1c71, #d76d77, #ffaf7b); position: relative; }
Â  Â  .icon-studio::after { content: '\f008'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: white; font-size: 28px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

Â  Â  .icon-settings { background: linear-gradient(180deg, #8e8e93 0%, #636366 100%); position: relative; }
Â  Â  .icon-settings::after { content: '\f013'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: #ddd; font-size: 35px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
Â  Â Â 
Â  Â  /* NEW: Widgets Icon */
Â  Â  .icon-widgets { background: linear-gradient(135deg, #4a4a4a, #1a1a1a); position: relative; }
Â  Â  .icon-widgets::after { content: '\f017'; /* clock */ font-family: 'Font Awesome 6 Free'; font-weight: 900; color: #ff9500; font-size: 28px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

Â  Â  .icon-trash { background: linear-gradient(180deg, #f2f2f7 0%, #d1d1d6 100%); position: relative; }
Â  Â  .icon-trash::after { content: '\f1f8'; font-family: 'Font Awesome 6 Free'; font-weight: 900; color: #777; font-size: 30px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }

</style>
</head>
<body>

Â  Â  Â  Â  <div id="boot-screen">
Â  Â  Â  Â  <i class="fab fa-apple apple-logo"></i>
Â  Â  Â  Â  <div class="loading-bar"><div class="loading-progress"></div></div>
Â  Â  </div>

Â  Â  Â  Â  <div id="desktop">
Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="menubar">
Â  Â  Â  Â  Â  Â  <div class="menu-left">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item"><i class="fab fa-apple apple-icon"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item" id="active-app-name">Finder</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">File</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">Edit</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">View</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">Go</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">Window</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item">Help</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="menu-right">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item"><i class="fas fa-battery-three-quarters"></i> <span id="battery-level">84%</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item"><i class="fas fa-wifi"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item"><i class="fas fa-search"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item"><i class="fas fa-sliders-h"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="menu-item" id="clock">Tue Jan 9 9:41 AM</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="windows-container"></div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="tiling-ghost"></div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="context-menu">
Â  Â  Â  Â  Â  Â  <div class="ctx-item" onclick="wm.openApp('finder')">New Folder</div>
Â  Â  Â  Â  Â  Â  <div class="ctx-hr"></div>
Â  Â  Â  Â  Â  Â  <div class="ctx-item">Get Info</div>
Â  Â  Â  Â  Â  Â  <div class="ctx-item" onclick="wm.openApp('settings')">Change Wallpaper...</div>
Â  Â  Â  Â  Â  Â  <div class="ctx-hr"></div>
Â  Â  Â  Â  Â  Â  <div class="ctx-item">Sort By</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="dock-container">
Â  Â  Â  Â  Â  Â  <div id="dock">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

<script>
Â  Â  // --- System Config & State ---
Â  Â  const apps = [
Â  Â  Â  Â  { id: 'finder', name: 'Finder', iconClass: 'icon-finder' },
Â  Â  Â  Â  { id: 'safari', name: 'Safari', iconClass: 'icon-safari' },
Â  Â  Â  Â  { id: 'terminal', name: 'Terminal', iconClass: 'icon-terminal' },
Â  Â  Â  Â  { id: 'textedit', name: 'TextEdit', iconClass: 'icon-text' },
Â  Â  Â  Â  { id: 'paint', name: 'Sketch', iconClass: 'icon-paint' },
Â  Â  Â  Â  { id: 'calculator', name: 'Calculator', iconClass: 'icon-calc', htmlIcon: '<div></div><div></div><div></div><div></div>' },
Â  Â  Â  Â  { id: 'studio', name: 'Studio', iconClass: 'icon-studio' },
Â  Â  Â  Â  { id: 'settings', name: 'Settings', iconClass: 'icon-settings' },
Â  Â  Â  Â  { id: 'widgets', name: 'Widgets', iconClass: 'icon-widgets' }, // NEW: Widgets App
Â  Â  Â  Â  { id: 'trash', name: 'Bin', iconClass: 'icon-trash', separator: true }
Â  Â  ];

Â  Â  // Simulated File System
Â  Â  const fileSystem = {
Â  Â  Â  Â  'Desktop': { type: 'folder', children: {
Â  Â  Â  Â  Â  Â  'Welcome.txt': { type: 'text', content: 'Welcome to macOS Sequoia Edition!\nThis is a simulation built in a single HTML file.'},
Â  Â  Â  Â  Â  Â  'Project': { type: 'folder', children: {} }
Â  Â  Â  Â  }},
Â  Â  Â  Â  'Documents': { type: 'folder', children: {
Â  Â  Â  Â  Â  Â  'notes.txt': { type: 'text', content: 'Buy milk\nFinish code'}
Â  Â  Â  Â  }},
Â  Â  Â  Â  'Downloads': { type: 'folder', children: {
Â  Â  Â  Â  Â  Â  'image.jpg': { type: 'img', src: ''}
Â  Â  Â  Â  }}
Â  Â  };
Â  Â  let currentPath = ['Desktop'];

Â  Â  // --- Window Manager Class ---
Â  Â  class WindowManager {
Â  Â  Â  Â  constructor() {
Â  Â  Â  Â  Â  Â  this.windows = {};
Â  Â  Â  Â  Â  Â  this.zIndexCounter = 100;
Â  Â  Â  Â  Â  Â  this.activeApp = 'Finder';
Â  Â  Â  Â  Â  Â  this.initDock();
Â  Â  Â  Â  Â  Â  this.setupDesktop();
Â  Â  Â  Â  }

Â  Â  Â  Â  initDock() {
Â  Â  Â  Â  Â  Â  const dock = $('#dock');
Â  Â  Â  Â  Â  Â  apps.forEach(app => {
Â  Â  Â  Â  Â  Â  Â  Â  if(app.separator) dock.append('<div style="width:1px; height:40px; background:rgba(255,255,255,0.2); margin: 0 5px;"></div>');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let iconHtml = app.htmlIcon ? app.htmlIcon : '';
Â  Â  Â  Â  Â  Â  Â  Â  let el = $(`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="dock-item" id="dock-${app.id}" title="${app.name}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="dock-icon-svg ${app.iconClass}">${iconHtml}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="dock-dot"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `);
Â  Â  Â  Â  Â  Â  Â  Â  el.on('click', () => this.openApp(app.id));
Â  Â  Â  Â  Â  Â  Â  Â  dock.append(el);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  setupDesktop() {
Â  Â  Â  Â  Â  Â  // Context Menu
Â  Â  Â  Â  Â  Â  $(document).on('contextmenu', '#desktop', (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  if ($(e.target).closest('.window').length === 0 && $(e.target).closest('#dock').length === 0 && $(e.target).closest('#menubar').length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#context-menu').css({top: e.clientY, left: e.clientX}).fadeIn(100);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  $(document).on('click', () => $('#context-menu').fadeOut(100));
Â  Â  Â  Â  }

Â  Â  Â  Â  updateMenubar(appName) {
Â  Â  Â  Â  Â  Â  this.activeApp = appName;
Â  Â  Â  Â  Â  Â  $('#active-app-name').text(appName);
Â  Â  Â  Â  }

Â  Â  Â  Â  setActiveWindow(id) {
Â  Â  Â  Â  Â  Â  $('.window').addClass('inactive');
Â  Â  Â  Â  Â  Â  $(`#win-${id}`).removeClass('inactive').css('z-index', ++this.zIndexCounter);
Â  Â  Â  Â  Â  Â  this.updateMenubar(this.windows[id].name);
Â  Â  Â  Â  }

Â  Â  Â  Â  openApp(appId) {
Â  Â  Â  Â  Â  Â  const appConfig = apps.find(a => a.id === appId);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const dockItem = $(`#dock-${appId}`);
Â  Â  Â  Â  Â  Â  if(!dockItem.hasClass('active') && !dockItem.hasClass('bouncing')) {
Â  Â  Â  Â  Â  Â  Â  Â  dockItem.addClass('bouncing');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => dockItem.removeClass('bouncing').addClass('active'), 600);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (this.windows[appId]) {
Â  Â  Â  Â  Â  Â  Â  Â  if($(`#win-${appId}`).is(':hidden')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.restoreWindow(appId);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  this.setActiveWindow(appId);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  this.createWindow(appId, appConfig);
Â  Â  Â  Â  }

Â  Â  Â  Â  // NEW: Tiling snap logic
Â  Â  Â  Â  getTilingRect(event, ui) {
Â  Â  Â  Â  Â  Â  const edgeThreshold = 20;
Â  Â  Â  Â  Â  Â  const topThreshold = 35; // Account for menubar
Â  Â  Â  Â  Â  Â  const screenW = $(window).width();
Â  Â  Â  Â  Â  Â  const screenH = $(window).height();
Â  Â  Â  Â  Â  Â  const menuH = 30;
Â  Â  Â  Â  Â  Â  const dockH = 80; // Approx.
Â  Â  Â  Â  Â  Â  const snapH = screenH - menuH - dockH;

Â  Â  Â  Â  Â  Â  const x = event.clientX;
Â  Â  Â  Â  Â  Â  const y = event.clientY;

Â  Â  Â  Â  Â  Â  // Top edge (Fullscreen)
Â  Â  Â  Â  Â  Â  if (y < topThreshold && x > 200 && x < screenW - 200) { // Avoid corners
Â  Â  Â  Â  Â  Â  Â  Â  return { top: menuH, left: 0, width: screenW, height: snapH };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // Left half
Â  Â  Â  Â  Â  Â  if (x < edgeThreshold) {
Â  Â  Â  Â  Â  Â  Â  Â  return { top: menuH, left: 0, width: screenW / 2, height: snapH };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // Right half
Â  Â  Â  Â  Â  Â  if (x > screenW - edgeThreshold) {
Â  Â  Â  Â  Â  Â  Â  Â  return { top: menuH, left: screenW / 2, width: screenW / 2, height: snapH };
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  return null; // No snap
Â  Â  Â  Â  }

Â  Â  Â  Â  createWindow(id, config) {
Â  Â  Â  Â  Â  Â  this.windows[id] = config;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let w = 600, h = 400;
Â  Â  Â  Â  Â  Â  if(id === 'calculator') { w = 250; h = 350; }
Â  Â  Â  Â  Â  Â  if(id === 'paint' || id === 'studio') { w = 700; h = 500; }
Â  Â  Â  Â  Â  Â  if(id === 'settings') { w = 550; h = 340; }
Â  Â  Â  Â  Â  Â  if(id === 'widgets') { w = 280; h = 380; } // NEW: Widgets size

Â  Â  Â  Â  Â  Â  const top = 50 + (Object.keys(this.windows).length * 20) % 150;
Â  Â  Â  Â  Â  Â  const left = 50 + (Object.keys(this.windows).length * 20) % 150;

Â  Â  Â  Â  Â  Â  const winHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="window opening" id="win-${id}" style="width:${w}px; height:${h}px; top:${top}px; left:${left}px; z-index:${++this.zIndexCounter}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="window-header">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="traffic-lights">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="t-btn close-btn"><i class="fas fa-times"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="t-btn min-btn"><i class="fas fa-minus"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="t-btn max-btn"><i class="fas fa-plus"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="window-title">${config.name}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="window-content" id="content-${id}"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  $('#windows-container').append(winHTML);
Â  Â  Â  Â  Â  Â  const $win = $(`#win-${id}`);

Â  Â  Â  Â  Â  Â  // NEW: Add merged-toolbar class to modern apps
Â  Â  Â  Â  Â  Â  if(id === 'finder' || id === 'safari' || id === 'settings' || id === 'textedit' || id === 'widgets') {
Â  Â  Â  Â  Â  Â  Â  Â  $win.addClass('merged-toolbar');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Make interactive
Â  Â  Â  Â  Â  Â  let ghostRect = null;
Â  Â  Â  Â  Â  Â  $win.draggable({ 
Â  Â  Â  Â  Â  Â  Â  Â  handle: '.window-header', 
Â  Â  Â  Â  Â  Â  Â  Â  containment: '#desktop', 
Â  Â  Â  Â  Â  Â  Â  Â  start: () => this.setActiveWindow(id),
Â  Â  Â  Â  Â  Â  Â  Â  // NEW: Tiling drag logic
Â  Â  Â  Â  Â  Â  Â  Â  drag: (event, ui) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if ($win.hasClass('maximized')) return false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ghostRect = this.getTilingRect(event, ui);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(ghostRect) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#tiling-ghost').css(ghostRect).show();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#tiling-ghost').hide();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  // NEW: Tiling stop logic
Â  Â  Â  Â  Â  Â  Â  Â  stop: (event, ui) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#tiling-ghost').hide();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(ghostRect) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $win.css({ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  top: ghostRect.top, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  left: ghostRect.left, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width: ghostRect.width, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height: ghostRect.height 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ghostRect = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(id==='paint') setTimeout(resizeCanvas, 250); // Resize canvas on snap
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(id==='terminal') startMatrix(); // Rel-launch matrix on snap
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .resizable({ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minHeight: 200, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minWidth: 250, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stop: ()=> { if(id==='paint') resizeCanvas(); }
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .on('mousedown', () => this.setActiveWindow(id));

Â  Â  Â  Â  Â  Â  // Window button events
Â  Â  Â  Â  Â  Â  $win.find('.close-btn').on('click', (e) => { e.stopPropagation(); this.closeWindow(id); });
Â  Â  Â  Â  Â  Â  $win.find('.min-btn').on('click', (e) => { e.stopPropagation(); this.minimizeWindow(id); });
Â  Â  Â  Â  Â  Â  $win.find('.max-btn').on('click', (e) => { e.stopPropagation(); this.maximizeWindow(id); });

Â  Â  Â  Â  Â  Â  setTimeout(() => $win.removeClass('opening'), 200);

Â  Â  Â  Â  Â  Â  this.setActiveWindow(id);
Â  Â  Â  Â  Â  Â  this.loadAppContent(id);
Â  Â  Â  Â  }

Â  Â  Â  Â  closeWindow(id) {
Â  Â  Â  Â  Â  Â  $(`#win-${id}`).fadeOut(150, function() { $(this).remove(); });
Â  Â  Â  Â  Â  Â  delete this.windows[id];
Â  Â  Â  Â  Â  Â  $(`#dock-${id}`).removeClass('active');
Â  Â  Â  Â  Â  Â  // Fallback to finder or next open window
Â  Â  Â  Â  Â  Â  const openWindows = Object.keys(this.windows);
Â  Â  Â  Â  Â  Â  if(openWindows.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  this.setActiveWindow(openWindows[openWindows.length - 1]);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  this.updateMenubar('Finder');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  minimizeWindow(id) {
Â  Â  Â  Â  Â  Â  $(`#win-${id}`).fadeOut(200);
Â  Â  Â  Â  Â  Â  this.updateMenubar('Finder');
Â  Â  Â  Â  }

Â  Â  Â  Â  restoreWindow(id) {
Â  Â  Â  Â  Â  Â  $(`#win-${id}`).fadeIn(200);
Â  Â  Â  Â  Â  Â  this.setActiveWindow(id);
Â  Â  Â  Â  }

Â  Â  Â  Â  maximizeWindow(id) {
Â  Â  Â  Â  Â  Â  const $win = $(`#win-${id}`);
Â  Â  Â  Â  Â  Â  if ($win.hasClass('maximized')) {
Â  Â  Â  Â  Â  Â  Â  Â  $win.css({ top: $win.data('top'), left: $win.data('left'), width: $win.data('width'), height: $win.data('height') }).removeClass('maximized');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  $win.data({ top: $win.css('top'), left: $win.css('left'), width: $win.css('width'), height: $win.css('height') });
Â  Â  Â  Â  Â  Â  Â  Â  const snapH = $(window).height() - 30 - 80;
Â  Â  Â  Â  Â  Â  Â  Â  $win.css({ top: '30px', left: '0', width: '100%', height: snapH }).addClass('maximized');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if(id==='paint') setTimeout(resizeCanvas, 250);
Â  Â  Â  Â  }

Â  Â  Â  Â  loadAppContent(id) {
Â  Â  Â  Â  Â  Â  const container = $(`#content-${id}`);
Â  Â  Â  Â  Â  Â  switch(id) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'finder': renderFinder(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'terminal': renderTerminal(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'textedit': renderTextEdit(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'paint': renderPaint(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'calculator': renderCalculator(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'safari': renderSafari(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'studio': renderStudio(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'settings': renderSettings(container); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'widgets': renderWidgets(container); break; // NEW
Â  Â  Â  Â  Â  Â  Â  Â  case 'trash': container.html('<div style="padding:20px; text-align:center; color:#aaa;">Trash is empty.<br><i class="fas fa-trash fa-3x" style="margin-top:20px;"></i></div>'); break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  const wm = new WindowManager();

Â  Â  // --- App Implementations ---

Â  Â  // 1. FINDER
Â  Â  function renderFinder(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="finder-layout">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="finder-sidebar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:10px; color:#888; padding-left:10px; margin-top:10px;">Favorites</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sidebar-item" onclick="navFinder(['Desktop'])"><i class="fas fa-desktop"></i> Desktop</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sidebar-item" onclick="navFinder(['Documents'])"><i class="fas fa-file-alt"></i> Documents</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="sidebar-item" onclick="navFinder(['Downloads'])"><i class="fas fa-download"></i> Downloads</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="finder-main">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-bottom:10px; color:#888; font-size:12px;"><i class="fas fa-chevron-left" style="opacity:0.5"></i> <i class="fas fa-chevron-right" style="opacity:0.5"></i> &nbsp; ${currentPath.join(' > ')}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="finder-grid" id="finder-grid"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â  updateFinderGrid();
Â  Â  }

Â  Â  window.navFinder = function(path) {
Â  Â  Â  Â  currentPath = path;
Â  Â  Â  Â  renderFinder($('#content-finder'));
Â  Â  }

Â  Â  function updateFinderGrid() {
Â  Â  Â  Â  const grid = $('#finder-grid');
Â  Â  Â  Â  grid.empty();
Â  Â  Â  Â Â 
Â  Â  Â  Â  let target = fileSystem;
Â  Â  Â  Â  currentPath.forEach(p => target = target[p] ? target[p].children : target);

Â  Â  Â  Â  if(!target) return;

Â  Â  Â  Â  Object.keys(target).forEach(key => {
Â  Â  Â  Â  Â  Â  const item = target[key];
Â  Â  Â  Â  Â  Â  let icon = 'fa-folder folder';
Â  Â  Â  Â  Â  Â  if(item.type === 'text') icon = 'fa-file-alt text';
Â  Â  Â  Â  Â  Â  if(item.type === 'img') icon = 'fa-file-image img';

Â  Â  Â  Â  Â  Â  const el = $(`
Â  Â  Â  Â  Â  Â  Â  Â  <div class="file-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas ${icon} file-icon"></i>
Â  Â  Â  Â  Â  Â  Â  _read_file_pathÂ  Â  Â  <div class="file-name">${key}</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  el.on('dblclick', () => {
Â  Â  Â  Â  Â  Â  Â  Â  if(item.type === 'folder') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPath.push(key);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderFinder($('#content-finder'));
Â  Â  Â  Â  Â  Â  Â  Â  } else if (item.type === 'text') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wm.openApp('textedit');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#text-area').val(item.content);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#win-textedit .window-title').text(key); // Set window title
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 200);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  grid.append(el);
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // 2. TERMINAL
Â  Â  let matrixInterval = null;
Â  Â  function renderTerminal(container) {
Â  Â  Â  Â  if(matrixInterval) clearInterval(matrixInterval);
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="terminal-app" id="term-output">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="term-line">Last login: ${new Date().toLocaleString()} on ttys000</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="term-line">macOS Sequoia Web [Version 2.0]</div>
Â  Â  Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="term-history"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="term-input-line">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="term-prompt">guest@macbook ~ %</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="term-input" autocomplete="off" autofocus>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const history = $('#term-history');
Â  Â  Â  Â  const input = $('#term-input');
Â  Â  Â  Â  const output = $('#term-output');

Â  Â  Â  Â  container.on('click', () => input.focus());
Â  Â  Â  Â  setTimeout(() => input.focus(), 500); // Focus on open

Â  Â  Â  Â  input.on('keydown', function(e) {
Â  Â  Â  Â  Â  Â  if(e.key === 'Enter') {
Â  Â  Â  Â  Â  Â  Â  Â  const cmd = this.value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  history.append(`<div class="term-line"><span class="term-prompt">guest@macbook ~ %</span> ${cmd}</div>`);
Â  Â  Â  Â  Â  Â  Â  Â  this.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  processCommand(cmd);
Â  Â  Â  Â  Â  Â  Â  Â  output.scrollTop(output[0].scrollHeight);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  function processCommand(cmd) {
Â  Â  Â  Â  Â  Â  const args = cmd.split(' ');
Â  Â  Â  Â  Â  Â  let response = '';
Â  Â  Â  Â  Â  Â  switch(args[0].toLowerCase()) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'help': response = 'Available commands: help, clear, ls, whoami, date, echo, matrix'; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'clear': history.empty(); return;
Â  Â  Â  Â  Â  Â  Â  Â  case 'ls': response = 'DesktopÂ  DocumentsÂ  Downloads'; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'whoami': response = 'guest'; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'date': response = new Date().toString(); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'echo': response = args.slice(1).join(' '); break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'sudo': response = 'Password: ðŸ”‘ (Just kidding, you have no power here)'; break;
Â  Â  Â  Â  Â  Â  Â  Â  case 'matrix': startMatrix(); return;
Â  Â  Â  Â  Â  Â  Â  Â  case '': return;
Â  Â  Â  Â  Â  Â  Â  Â  default: response = `zsh: command not found: ${args[0]}`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  history.append(`<div class="term-line">${response}</div>`);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function startMatrix() {
Â  Â  Â  Â  if(matrixInterval) clearInterval(matrixInterval);
Â  Â  Â  Â  const container = $('#content-terminal');
Â  Â  Â  Â  container.html('<canvas id="matrix" style="display:block;"></canvas>');
Â  Â  Â  Â  const C = document.getElementById("matrix");
Â  Â  Â  Â  if(!C) return;
Â  Â  Â  Â  const $p = C.parentElement; C.width=$p.clientWidth; C.height=$p.clientHeight;
Â  Â  Â  Â  const ctx=C.getContext("2d");
Â  Â  Â  Â  const txts = "01"; const msg = txts.split("");
Â  Â  Â  Â  const font_size = 10; const columns = C.width/font_size; const drops = [];
Â  Â  Â  Â  for(let x=0; x<columns; x++) drops[x]=1;
Â  Â  Â  Â  function draw(){
Â  Â  Â  Â  Â  Â  ctx.fillStyle="rgba(0, 0, 0, 0.05)"; ctx.fillRect(0,0,C.width,C.height);
Â  Â  Â  Â  Â  Â  ctx.fillStyle="#0F0"; ctx.font = font_size + "px monospace";
Â  Â  Â  Â  Â  Â  for(let i=0; i<drops.length; i++){
Â  Â  Â  Â  Â  Â  Â  Â  const text = msg[Math.floor(Math.random()*msg.length)];
Â  Â  Â  Â  Â  Â  Â  Â  ctx.fillText(text, i*font_size, drops[i]*font_size);
Â  Â  Â  Â  Â  Â  Â  Â  if(drops[i]*font_size > C.height && Math.random() > 0.975) drops[i]=0;
Â  Â  Â  Â  Â  Â  Â  Â  drops[i]++;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  matrixInterval = setInterval(draw, 33);
Â  Â  }

Â  Â  // 3. TEXTEDIT
Â  Â  function renderTextEdit(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="textedit-app">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="text-tool"><option>Helvetica</option><option>Courier</option><option>Times</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="text-tool"><option>12</option><option>14</option><option>18</option></select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="text-tool"><i class="fas fa-bold"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="text-tool"><i class="fas fa-italic"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="text-area" placeholder="Start typing..."></textarea>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  }

Â  Â  // 4. SKETCH (Paint)
Â  Â  let canvas, ctx, painting = false;
Â  Â  function renderPaint(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="paint-app">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="paint-toolbar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="color" id="p-color" value="#000000">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="range" id="p-size" min="1" max="50" value="5" title="Brush Size">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="text-tool" onclick="clearCanvas()"><i class="fas fa-trash"></i> Clear</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="text-tool" id="p-eraser"><i class="fas fa-eraser"></i></button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="flex:1; overflow:hidden; position:relative;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="paint-canvas"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â Â 
Â  Â  Â  Â  setTimeout(initCanvas, 100); // Wait for DOM
Â  Â  }

Â  Â  function initCanvas() {
Â  Â  Â  Â  canvas = document.getElementById('paint-canvas');
Â  Â  Â  Â  if(!canvas) return;
Â  Â  Â  Â  ctx = canvas.getContext('2d');
Â  Â  Â  Â  resizeCanvas();
Â  Â  Â  Â Â 
Â  Â  Â  Â  let color = '#000000';
Â  Â  Â  Â  let size = 5;
Â  Â  Â  Â  let mode = 'draw';

Â  Â  Â  Â  $('#p-color').on('change', function() { color = this.value; mode='draw'; });
Â  Â  Â  Â  $('#p-size').on('input', function() { size = this.value; });
Â  Â  Â  Â  $('#p-eraser').on('click', function() { mode = 'erase'; });

Â  Â  Â  Â  function startPosition(e) {
Â  Â  Â  Â  Â  Â  painting = true;
Â  Â  Â  Â  Â  Â  draw(e);
Â  Â  Â  Â  }
Â  Â  Â  Â  function finishedPosition() {
Â  Â  Â  Â  Â  Â  painting = false;
Â  Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  }
Â  Â  Â  Â  function draw(e) {
Â  Â  Â  Â  Â  Â  if (!painting) return;
Â  Â  Â  Â  Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  Â  Â  Â  Â  ctx.lineWidth = size;
Â  Â  Â  Â  Â  Â  ctx.lineCap = 'round';
Â  Â  Â  Â  Â  Â  ctx.strokeStyle = mode === 'erase' ? '#ffffff' : color;

Â  Â  Â  Â  Â  Â  ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
Â  Â  Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  Â  ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
Â  Â  Â  Â  }

Â  Â  Â  Â  canvas.addEventListener('mousedown', startPosition);
Â  Â  Â  Â  canvas.addEventListener('mouseup', finishedPosition);
Â  Â  Â  Â  canvas.addEventListener('mousemove', draw);
Â  Â  }

Â  Â  window.resizeCanvas = function() {
Â  Â  Â  Â  if(!canvas) return;
Â  Â  Â  Â  const parent = canvas.parentElement;
Â  Â  Â  Â  // Save img data
Â  Â  Â  Â  let imgData = null;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  imgData = ctx.getImageData(0,0,canvas.width, canvas.height);
Â  Â  Â  Â  } catch(e) { /* Fails on 0x0 canvas, ignore */ }
Â  Â  Â  Â  
Â  Â  Â  Â  canvas.width = parent.clientWidth;
Â  Â  Â  Â  canvas.height = parent.clientHeight;
Â  Â  Â  Â  // Fill white background
Â  Â  Â  Â  ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  if(imgData) ctx.putImageData(imgData, 0,0);
Â  Â  }
Â  Â  window.clearCanvas = function() {
Â  Â  Â  Â  ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height);
Â  _read_file_path }

Â  Â  // 5. CALCULATOR
Â  Â  function renderCalculator(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="calc-app">
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="calc-display" value="0" readonly>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="calc-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-top" onclick="calcClear()">AC</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-top" onclick="calcExtra('sign')">+/-</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-top" onclick="calcExtra('pct')">%</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-op" onclick="calcOp('/')">Ã·</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(7)">7</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(8)">8</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(9)">9</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-op" onclick="calcOp('*')">Ã—</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(4)">4</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(5)">5</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(6)">6</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-op" onclick="calcOp('-')">âˆ’</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(1)">1</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(2)">2</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcNum(3)">3</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-op" onclick="calcOp('+')">+</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num c-zero" onclick="calcNum(0)">0</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-num" onclick="calcExtra('dot')">.</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="calc-btn c-op" onclick="calcEq()">=</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  }
Â  Â Â 
Â  Â  let calcCur = '0', calcPrev = null, calcOper = null, newNum = true;
Â  Â  const updateDisp = () => $('#calc-display').val(parseFloat(calcCur).toLocaleString());
Â  Â  window.calcNum = (num) => {
Â  Â  Â  Â  if(newNum) { calcCur = num.toString(); newNum = false; } else { calcCur = calcCur === '0' ? num.toString() : calcCur + num; }
Â  Â  Â  Â  updateDisp();
Â  Â  };
Â  Â  window.calcOp = (op) => { calcEq(); calcPrev = parseFloat(calcCur); calcOper = op; newNum = true; };
Â  Â  window.calcClear = () => { calcCur='0'; calcPrev=null; calcOper=null; newNum=true; updateDisp(); };
Â  Â  window.calcExtra = (type) => {
Â  Â  Â  Â  if(type === 'dot' && !calcCur.includes('.')) calcCur += '.';
Â  Â  Â  Â  if(type === 'sign') calcCur = (parseFloat(calcCur) * -1).toString();
Â  Â  Â  Â  if(type === 'pct') calcCur = (parseFloat(calcCur) / 100).toString();
Â  Â  Â  Â  updateDisp();
Â  Â  };
Â  Â  window.calcEq = () => {
Â  Â  Â  Â  if(calcOper && !newNum && calcPrev !== null) {
Â  Â  Â  Â  Â  Â  const cur = parseFloat(calcCur);
Â  Â  Â  Â  Â  Â  switch(calcOper){
Â  Â  Â  Â  Â  Â  Â  Â  case '+': calcCur = (calcPrev + cur).toString(); break;
Â  Â  Â  Â  Â  Â  Â  Â  case '-': calcCur = (calcPrev - cur).toString(); break;
Â  Â  Â  Â  Â  Â  Â  Â  case '*': calcCur = (calcPrev * cur).toString(); break;
Â  Â  Â  Â  Â  Â  Â  Â  case '/': calcCur = (calcPrev / cur).toString(); break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  calcOper = null; calcPrev = null; newNum = true; updateDisp();
Â  Â  Â  Â  }
Â  Â  };

Â  Â  // 6. SAFARI
Â  Â  function renderSafari(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="safari-app">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="safari-bar">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-chevron-left"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-chevron-right"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-redo"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="url-bar" value="en.wikipedia.org/wiki/MacOS_Sequoia" id="safari-url">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-share-square"></i>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <iframe src="https://en.wikipedia.org/wiki/MacOS_Sequoia"class="safari-frame" id="safari-frame" sandbox="allow-scripts allow-same-origin"></iframe>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â  $('#safari-url').on('keypress', function(e) {
Â  Â  Â  Â  Â  Â  if(e.which == 13) {
Â  Â  Â  Â  Â  Â  Â  Â  let url = this.value;
Â  Â  Â  Â  Â  Â  Â  Â  // Poor man's URL proxy - this will be blocked by most sites due to X-Frame-Options
Â  Â  Â  Â  Â  Â  Â  Â  // For a real demo, you'd need a proxy server. We'll just load wikipedia again.
Â  Â  Â  Â  Â  Â  Â  Â  if(url.includes('wikipedia.org')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!url.startsWith('http')) url = 'https://' + url;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#safari-frame').attr('src', url);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  $('#safari-frame').attr('srcdoc', `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style='font-family:sans-serif; padding:20px; color:black;'>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2>Content Blocked</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>Most websites (like <b>${url}</b>) block themselves from being loaded in an iframe for security reasons (X-Frame-Options).</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>This simulation only allows loading <b>Wikipedia.org</b>.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="history.back()">Go Back</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // 7. STUDIO (Video Editor sim)
Â  Â  function renderStudio(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="studio-app">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="video-stage">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="vid-placeholder" style="width:80%; height:80%; background:linear-gradient(45deg, #ff00cc, #3333ff); animation: hue 5s infinite linear; display:flex; justify-content:center; align-items:center; color:white; font-weight:bold; font-size:20px; transition:filter 0.3s;">NO SIGNAL</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <style>@keyframes hue { 0%{filter: hue-rotate(0deg);} 100%{filter: hue-rotate(360deg);} }</style>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="studio-controls">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="filters-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="color:#888; font-size:10px; align-self:center;">Filters:</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" onclick="applyFilter('none')">Normal</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" onclick="applyFilter('grayscale(1)')">B&W</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" onclick="applyFilter('sepia(1)')">Sepia</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" onclick="applyFilter('blur(5px)')">Blur</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="filter-btn" onclick="applyFilter('invert(1)')">Invert</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="playback-row">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-backward"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-play" id="play-btn" style="font-size:20px; color:white; cursor:pointer;"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i class="fas fa-forward"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="height:3px; background:#333; margin-top:5px;"><div style="width:40%; height:100%; background:var(--accent);"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â Â 
Â  Â  Â  Â  let playing = true;
Â  Â  Â  Â  $('#play-btn').on('click', function() {
Â  Â  Â  Â  Â  Â  playing = !playing;
Â  Â  Â  Â  Â  Â  $(this).toggleClass('fa-play fa-pause');
Â  Â  Â  Â  Â  Â  $('#vid-placeholder').css('animation-play-state', playing ? 'running' : 'paused');
Â  Â  Â  Â  });
Â  Â  }
Â  Â  window.applyFilter = function(filter) {
Â  Â  Â  Â  $('#vid-placeholder').css('animation', 'hue 5s infinite linear');
Â  Â  Â  Â  $('#vid-placeholder').css('filter', filter === 'none' ? '' : filter);
Â  Â  }

Â  Â  // 8. SETTINGS
Â  Â  function renderSettings(container) {
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="settings-app">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:15px; width:100%; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="width:60px; height:60px; background:#ccc; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:30px; color:#555;"><i class="fas fa-user"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div><div style="font-weight:600; font-size:16px;">Guest User</div><div style="font-size:12px; color:#aaa;">Apple ID, iCloud, Media & App Store</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="align-self:flex-start; font-weight:600;">Wallpaper</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="wall-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="wall-thumb" style="background: linear-gradient(160deg, #1a4a2a, #2a5f3a, #f2a94a, #f5c07b, #5b8abf, #2a4b7a);" onclick="changeWall(this)"><span>Sequoia</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="wall-thumb" style="background: linear-gradient(200deg, #a729f5, #5823d6, #092775, #1d6f9c);" onclick="changeWall(this)"><span>Monterey</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="wall-thumb" style="background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);" onclick="changeWall(this)"><span>Blush</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="wall-thumb" style="background: url('https://source.unsplash.com/random/800x600?nature,mountain');" onclick="changeWall(this)"><span>Unsplash</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="wall-thumb" style="background: #000;" onclick="changeWall(this)"><span>Solid</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â  // Select current wallpaper
Â  Â  Â  Â  const currentBg = $('body').css('background');
Â  Â  Â  Â  $('.wall-thumb').each(function() {
Â  Â  Â  Â  Â  Â  if(currentBg.includes($(this).css('background-image'))) {
Â  Â  Â  Â  Â  Â  Â  Â  $(this).addClass('selected');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
Â  Â  window.changeWall = function(el) {
Â  Â  Â  Â  $('.wall-thumb').removeClass('selected');
Â  Â  Â  Â  $(el).addClass('selected');
Â  Â  Â  Â  const newBg = $(el).css('background');
Â  Â  Â  Â  
Â  Â  Â  Â  // Reset animation for dynamic gradients
Â  Â  Â  Â  if (newBg.includes('linear-gradient')) {
Â  Â  Â  Â  Â  Â  $('body').css({'background': newBg, 'background-size': '600% 600%', 'animation': 'none'});
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  $('body').css('animation', 'gradientBG 20s ease infinite');
Â  Â  Â  Â  Â  Â  }, 10);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // For solid or image backgrounds
Â  Â  Â  Â  Â  Â  $('body').css({'background': newBg, 'background-size': 'cover', 'background-position': 'center', 'animation': 'none'});
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // 9. NEW: WIDGETS
Â  Â  let widgetInterval;
Â  Â  function renderWidgets(container) {
Â  Â  Â  Â  if(widgetInterval) clearInterval(widgetInterval);
Â  Â  Â  Â  container.html(`
Â  Â  Â  Â  Â  Â  <div class="widgets-app">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="widget widget-clock" id="widget-clock">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="time">10:09</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="date">Tuesday, Nov 11</div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  _read_file_path Â  Â  Â  <div class="widget widget-weather">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="icon"><i class="fas fa-sun"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  sub_task_result
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="temp">72Â°</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="loc">Cupertino</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="widget widget-weather">
Â  Â  Â  Â  _read_file_path Â  Â  Â  Â  Â  <div class="icon" style="color:#5ac8fa;"><i class="fas fa-wind"></i></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="temp">8<span style="font-size:16px;"> mph</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="loc">Wind</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `);
Â  Â  Â  Â  // Make the clock widget live
Â  Â  Â  Â  function updateWidgetClock() {
Â  Â  Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  Â  Â  const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
Â  Â  Â  Â  Â  Â  const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
Â  Â  Â  Â  Â  Â  $('#widget-clock .time').text(timeStr);
Â  Â  Â  Â  Â  Â  $('#widget-clock .date').text(dateStr);
Â  Â  Â  Â  }
Â  Â  Â  Â  updateWidgetClock(); // Run once
Â  Â  Â  Â  widgetInterval = setInterval(updateWidgetClock, 1000); // Update every second
Â  Â  }

Â  Â  // --- Infrastructure ---

Â  Â  // Clock
Â  Â  function updateClock() {
Â  Â  Â  Â  const now = new Date();
Â  Â  Â  Â  const dateStr = now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
Â  Â  Â  Â  const timeStr = now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
Â  Â  Â  Â  $('#clock').text(`${dateStr} ${timeStr}`);
Â  Â  }
Â  Â  setInterval(updateClock, 1000);
Â  Â  updateClock();

Â  Â  // Battery (if supported)
Â  Â  if ('getBattery' in navigator) {
Â  Â  Â  Â  navigator.getBattery().then(battery => {
CSS and JS fixes.
Â  Â  Â  Â  Â  Â  $('#battery-level').text(Math.round(battery.level * 100) + '%');
Â  Â  Â  Â  });
Â  Â  }

Â  Â  // Boot Sequence
Â  Â  $(window).on('load', () => {
Â  Â  Â  Â  $('.loading-progress').css('width', '100%');
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  $('#boot-screen').fadeOut(500, function(){ $(this).remove(); });
Â  Â  Â  Â  Â  Â  // Auto open Finder on boot
Â  Â  Â  Â  Â  Â  setTimeout(() => wm.openApp('finder'), 600);
Â  Â  Â  Â  }, 3200);
Â  Â  });

</script>
</body>
</html>
